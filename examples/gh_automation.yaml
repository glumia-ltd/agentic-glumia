version: 1
project:
  id: gh-automation-demo
  goal: "Generate spec, commit to GitHub on a branch, and open a PR"
  context:
    repo: "${GITHUB_OWNER}/${GITHUB_REPO}"
phases:
  - id: intake
    entry_prompt: curator
    outputs: ["requirements.md"]
    transitions:
      on_complete: design
  - id: design
    entry_prompt: designer
    tasks:
      - id: branch
        tool_calls: ["github.create_branch:name=feat/blueprint|from=main"]
      - id: issue
        tool_calls: ["github.create_issue:title=Draft spec|body=Auto-generated by agent"]
    transitions:
      on_approved: implement
  - id: implement
    entry_prompt: implementer
    tasks:
      - id: commit_spec
        tool_calls: ["github.commit_artifact:phase=design|path=docs/spec.md|branch=feat/blueprint|message=feat: add initial spec"]
      - id: open_pr
        tool_calls: ["github.open_pr:title=feat: initial spec|head=feat/blueprint|base=main|body=Auto-PR from agent"]
    transitions:
      on_all_tasks_green: review
  - id: review
    entry_prompt: qa
    gate:
      type: automated_checks
      tools: ["ci.run_tests"]
    transitions:
      on_pass: ship
  - id: ship
    entry_prompt: release
    tasks:
      - id: deploy
        tool_calls: ["deploy.vercel"]
    transitions:
      on_complete: done
